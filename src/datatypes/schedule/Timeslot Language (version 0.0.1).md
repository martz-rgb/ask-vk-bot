 **Timeslot Language** — это декларативный язык для описания дат, повторяющихся с некоторой периодичностью, расписаний.

Даты, которые повторяются с некоторой периодичностью, будем называть временными окнами (англ. timeslot).

### Описание языка

Любое выражение в **Timeslot Language** строится по схеме:
`<список временных окон> (except <список исключаемых временных окон),` 
где вторая часть может отсутствовать.

Временные окна в списке перечисляются через запятую.

> [!Example]
> - `every day except Sundays` обозначает каждый день за исключением воскресений,
> - `first Mondays` обозначает первый понедельник месяца, 
> - `Tuesdays, Thursdays, Saturdays except odd date, -1` обозначает каждый вторник, четверг и субботу за исключением нечетных дат и последнего дня месяца.
#### Типы временных окон
Временное окно может принадлежать одному из трех типов:
1. число месяца `num` с областью значений от `-28` до `28` за исключением `0`,

> [!Example]
> `5` — пятое число месяца,
> `-1` — последний день месяца.

2. день недели в множественном числе,

> [!Example]
> `Mondays`, `Tuesdays` или `Saturdays`.

3. любой день `day` или `date`. 

>[!Note]
>В большинстве ситуации `day` и `date` синонимичны, но они имеют разный смысл при описании временных окон с кратностью. Читайте подробнее в [[Timeslot Language (version 0.0.1)#3. Модификаторы кратности|модификаторах кратности]].

#### Модификаторы
В большинстве случаев для расписаний требуются не какие-то случайные дни, а дни, которые удовлетворяют некоторым условиям. Например, последний четверг месяца или четная дата. Для этого в **Timeslot Language** есть модификаторы временных окон.

Синтаксис модификаторов: `<модификатор> <список временных окон с допустимым типом>`.

Здесь важно отметить, что модификатор влияет не только на стоящее после него временное окно, но и на все последующие, к которым он может быть применен. Если встречается временное окно, к которому модификатор не может быть применен, или появляется новый модификатор, то текущий сбрасывается.

>[!Attention]
>Обратите внимание, что к числам месяца никакие модификаторы не применимы.

##### 1. Модификатор `every`
Ключевые слова: `every`

Применимо к `day`, `date` и дням недели.

Значение: в расписание входит каждое временное окно заданного типа.

Модификатор `every` является модификатором **по умолчанию**.

>[!Tip]
>Для дней недели модификатор `every` можно опускать.

>[!Example]
>`every day` — обозначает каждый день,
>`Fridays` — обозначает каждую пятницу.

##### 2. Модификаторы порядка
Ключевые слова: `first`, `second`, `third`, `forth`, `fifth`, `last`, `penultimate`, `first from end`, `second from end`, `third from end`, `forth from end` и `fifth from end`. 
Ключевые слова `last` и `penultimate` являются сокращениями для `first from end` и `second from end` соответственно.

Применимо только к дням недели.

Значение: в расписание входят дни недели, принадлежащие заданной неделе месяца.

>[!Note]
>Хоть и модификатор порядка `fifth` ссылается на пятую неделю месяца, будьте внимательны, что она может отсутствовать в месяце. Для того, чтобы сослаться на последнюю неделю месяца, используйте модификатор `last`. 
>Аналогично для `fifth from end`.

> [!Example]
> `first Mondays` — обозначает первый понедельник месяца,
> `forth from end Tuesdays, Thursdays` — обозначает вторники и четверги, после которых пройдет еще три вторника и четверга.

##### 3. Модификаторы кратности
Ключевые слова: `module <число> residue <список чисел>`, `even`, `odd`.
Ключевые слова `even` и `odd` являются сокращениями для `module 2 residue 0` и `module 2 residue 1` соответственно.

Применимо к `day`, `date` и дням недели.

Значение: в расписание входят только даты или дни недели, которые при делении на заданное число дают один из заданных остатков.

> [!Example]
> `odd Mondays` — обозначает, что в расписание входят только нечетные понедельники,
> `module 3 residue 1, 2 day` — обозначает, что в расписание входят дни, которые при делении на 3 дают остаток 1 или 2.

>[!Tip]
>Для модификаторов вида `module <число> residue 0` можно опускать определение остатка и кратко записывать `module <число>`.

Обратите внимание, как конкретно вычисляются кратности для разных типов временных окон:
1. для дней недели их кратность определяется по **номеру их недели в году**,

> [!Example]
> Вторник 28 мая 2024 входит в 22 неделю года, — то есть этот вторник будет **четным**.

2. для ключевого слова `date` кратность дня определяется по **его номеру в месяце**,

> [!Example]
> Вторник 28 мая 2024 — это 28 день в месяце, — и он будет **четным**.

3. для ключевого слова `day` кратность дня определяется по **его номеру в году**,

> [!Example]
> Вторник 28 мая 2024 является 149  днем в году, — и он будет **нечетным**.

Как можно заметить, кратности дня относительно месяца и года не всегда совпадают. При этом оба способа подсчета могут быть полезны: использование выражения `odd date`  приведет к тому, чтов расписании будут нечетные числа месяца (1, 3, 5 и т.д.); в то время как выражение `odd day` даст эффект того, что временное окно будет каждые два дня независимо от месяца.

#### Исключаемые временные окна
Для того, чтобы удалить из расписание часть окон, используется ключевое слово `except`, после которого идет список исключаемых временных окон. В этом списке могут быть любые временные окна с модификаторами, за исключением временных окон `every day` и `every date`.